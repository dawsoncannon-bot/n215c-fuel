<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="N215C Fuel">
  <meta name="theme-color" content="#0a0a0a">
  <title>N215C Fuel Tracker</title>
  
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      min-height: 100vh;
      background-color: #0a0a0a;
      color: #fff;
      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
      padding: 16px;
      padding-top: max(16px, env(safe-area-inset-top));
      padding-bottom: max(16px, env(safe-area-inset-bottom));
      -webkit-user-select: none;
      user-select: none;
    }
    
    .hidden { display: none !important; }
    
    #start-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 85vh;
      gap: 8px;
    }
    
    .title { font-size: 48px; font-weight: 700; letter-spacing: 4px; color: #FFE66D; }
    .subtitle { font-size: 14px; letter-spacing: 8px; color: #666; margin-bottom: 32px; }
    
    .resume-box {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      margin-bottom: 32px;
      padding: 20px 24px;
      background-color: #111;
      border: 1px solid #FFE66D44;
      border-radius: 12px;
      width: 100%;
      max-width: 340px;
    }
    .resume-box.visible { display: flex; }
    
    .resume-title { font-size: 12px; letter-spacing: 2px; color: #FFE66D; }
    .resume-info { font-size: 14px; color: #888; text-align: center; }
    
    .resume-buttons { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
    
    .resume-btn {
      padding: 12px 18px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 1px;
      border: 2px solid #333;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
    }
    .resume-btn.primary { background-color: #FFE66D; border-color: #FFE66D; color: #000; }
    .resume-btn.secondary { background-color: transparent; border-color: #4ECDC4; color: #4ECDC4; }
    .resume-btn.tertiary { background-color: transparent; border-color: #444; color: #666; }
    
    .add-fuel-panel {
      display: none;
      flex-direction: column;
      gap: 14px;
      width: 100%;
      padding-top: 16px;
      border-top: 1px solid #333;
    }
    .add-fuel-panel.visible { display: flex; }
    
    .add-fuel-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
    
    .add-fuel-tank {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 10px 4px;
      background-color: #1a1a1a;
      border-radius: 8px;
    }
    .add-fuel-label { font-size: 8px; letter-spacing: 1px; color: #666; }
    .add-fuel-current { font-size: 13px; color: #888; }
    .add-fuel-row { display: flex; align-items: center; gap: 2px; }
    .add-fuel-plus { font-size: 12px; color: #4ECDC4; }
    .add-fuel-input {
      width: 36px;
      height: 26px;
      font-size: 13px;
      font-weight: 700;
      text-align: center;
      background-color: #0a0a0a;
      border: 1px solid #4ECDC4;
      border-radius: 4px;
      color: #4ECDC4;
      font-family: inherit;
    }
    .add-fuel-input:focus { outline: none; }
    .add-fuel-new { font-size: 12px; font-weight: 700; color: #FFE66D; }
    
    .add-fuel-summary {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      background-color: #1a1a1a;
      border-radius: 6px;
    }
    .add-fuel-summary-label { font-size: 10px; letter-spacing: 1px; color: #888; }
    .add-fuel-summary-value { font-size: 20px; font-weight: 700; color: #FFE66D; }
    
    .add-fuel-start {
      width: 100%;
      padding: 14px;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 2px;
      background-color: #4ECDC4;
      border: none;
      border-radius: 8px;
      color: #000;
      cursor: pointer;
      font-family: inherit;
    }
    
    .new-flight-label { font-size: 11px; letter-spacing: 3px; color: #666; margin-bottom: 16px; }
    
    .preset-buttons { display: flex; gap: 20px; margin-bottom: 20px; }
    
    .preset-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 28px 36px;
      background-color: #1a1a1a;
      border: 2px solid #333;
      border-radius: 12px;
      cursor: pointer;
      gap: 6px;
    }
    .preset-btn:active { transform: scale(0.98); border-color: #4ECDC4; }
    .preset-name { font-size: 22px; font-weight: 700; color: #fff; }
    .preset-detail { font-size: 16px; color: #4ECDC4; }
    .preset-tanks { font-size: 10px; color: #666; letter-spacing: 1px; }
    
    .splash-btn {
      padding: 10px 20px;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 2px;
      background-color: transparent;
      border: 1px solid #333;
      border-radius: 6px;
      color: #555;
      cursor: pointer;
      font-family: inherit;
    }
    .splash-btn:active { border-color: #4ECDC4; color: #4ECDC4; }
    
    /* Splash Panel */
    .splash-panel {
      display: none;
      flex-direction: column;
      gap: 14px;
      width: 100%;
      max-width: 340px;
      margin-top: 20px;
      padding: 20px;
      background-color: #111;
      border: 1px solid #333;
      border-radius: 12px;
    }
    .splash-panel.visible { display: flex; }
    .splash-title { font-size: 11px; letter-spacing: 2px; color: #666; text-align: center; }
    
    #flight-screen { display: none; }
    
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #222;
    }
    .header-left { display: flex; gap: 8px; }
    .reset-btn, .undo-btn {
      width: 44px; height: 44px;
      background: transparent;
      border: 1px solid #444;
      border-radius: 8px;
      color: #666;
      font-size: 18px;
      cursor: pointer;
      font-family: inherit;
    }
    .undo-btn:disabled { opacity: 0.3; cursor: default; }
    .header-center { display: flex; flex-direction: column; align-items: center; gap: 4px; }
    .preset-badge { font-size: 11px; letter-spacing: 3px; color: #666; }
    .total-fuel { font-size: 24px; font-weight: 700; color: #4ECDC4; }
    .swap-count { font-size: 18px; color: #666; width: 44px; text-align: right; }
    
    .phase-indicator {
      text-align: center;
      font-size: 10px;
      letter-spacing: 2px;
      color: #666;
      margin-bottom: 12px;
      padding: 8px;
      background-color: #111;
      border-radius: 6px;
    }
    .phase-indicator.tips-phase { color: #FFE66D; border: 1px solid #FFE66D33; }
    .phase-indicator.endurance-mode { color: #FFE66D; border: 1px solid #FFE66D33; }
    .phase-indicator.balanced-mode { color: #4ECDC4; border: 1px solid #4ECDC433; }
    .phase-indicator.exhausted { color: #FF6B6B; border: 1px solid #FF6B6B55; background-color: #1a0a0a; }
    
    .reserve-display {
      text-align: center;
      font-size: 9px;
      letter-spacing: 1px;
      color: #444;
      margin-bottom: 10px;
    }
    
    .tank-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 8px;
    }
    .wing { display: flex; gap: 8px; }
    .tank {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      background-color: #111;
      border: 2px solid #333;
      border-radius: 8px;
      width: 65px;
    }
    .tank.active { border-color: #FFE66D; }
    .tank.locked { opacity: 0.4; }
    .tank.empty { opacity: 0.3; }
    .tank-label { font-size: 9px; letter-spacing: 1px; color: #666; margin-bottom: 6px; }
    .tank-bar-outer {
      width: 28px; height: 70px;
      background-color: #1a1a1a;
      border-radius: 4px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }
    .tank-bar-inner {
      width: 100%;
      background-color: #4ECDC4;
      transition: height 0.3s;
      border-radius: 2px;
    }
    .tank-bar-inner.active { background-color: #FFE66D; }
    .tank-bar-inner.low { background-color: #FF6B6B; }
    .tank-value { font-size: 14px; font-weight: 700; margin-top: 6px; color: #fff; }
    .tank-value.low { color: #FF6B6B; }
    
    .center-indicator {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 16px;
      background-color: #111;
      border-radius: 12px;
      border: 1px solid #222;
      min-width: 110px;
    }
    .current-tank-label { font-size: 9px; letter-spacing: 2px; color: #666; }
    .current-tank { font-size: 20px; font-weight: 700; margin-top: 4px; }
    .current-tank.left { color: #4ECDC4; }
    .current-tank.right { color: #FF6B6B; }
    .next-tank-prompt {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid #222;
      font-size: 8px;
      letter-spacing: 1px;
      color: #666;
    }
    .next-tank-name { font-size: 12px; font-weight: 700; color: #FFE66D; margin-top: 2px; }
    
    .info-display { display: flex; justify-content: center; margin-bottom: 14px; }
    .info-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 20px;
      background-color: #111;
      border-radius: 10px;
      border: 1px solid #222;
    }
    .info-label { font-size: 9px; letter-spacing: 2px; color: #666; margin-bottom: 6px; }
    .info-value { font-size: 28px; font-weight: 700; color: #fff; }
    
    .swap-targets { display: flex; justify-content: center; gap: 16px; margin-bottom: 14px; }
    .swap-target-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 14px 24px;
      background-color: #111;
      border-radius: 10px;
      border: 1px solid #222;
      min-width: 140px;
    }
    .swap-target-box.balanced { border-color: #4ECDC455; }
    .swap-target-box.endurance { border-color: #FFE66D55; }
    .swap-target-box.locked-balanced { border-color: #4ECDC4; min-width: 160px; }
    .swap-target-box.locked-endurance { border-color: #FFE66D; min-width: 160px; }
    .swap-target-box.warning { border-color: #FF6B6B; background-color: #1a0a0a; min-width: 180px; }
    .swap-target-box.zero-fuel { border-color: #FF6B6B; background-color: #2a0a0a; min-width: 200px; border-width: 2px; }
    .swap-target-label { font-size: 9px; letter-spacing: 2px; color: #666; margin-bottom: 8px; }
    .swap-target-label.warning { color: #FF6B6B; font-weight: 700; }
    .swap-target-label.zero-fuel { color: #FF6B6B; font-weight: 700; font-size: 11px; }
    .swap-target-value { font-size: 32px; font-weight: 700; }
    .swap-target-box.balanced .swap-target-value { color: #4ECDC4; }
    .swap-target-box.endurance .swap-target-value { color: #FFE66D; }
    .swap-target-box.locked-balanced .swap-target-value { color: #4ECDC4; }
    .swap-target-box.locked-endurance .swap-target-value { color: #FFE66D; }
    .swap-target-box.warning .swap-target-value { color: #FF6B6B; }
    .swap-target-box.zero-fuel .swap-target-value { color: #FF6B6B; font-size: 36px; }
    
    .input-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
    }
    .input-label { font-size: 11px; letter-spacing: 2px; color: #666; }
    .input-field {
      width: 180px; height: 60px;
      font-size: 32px; font-weight: 700;
      text-align: center;
      background-color: #1a1a1a;
      border: 2px solid #333;
      border-radius: 8px;
      color: #fff;
      font-family: inherit;
    }
    .input-field:focus { outline: none; border-color: #4ECDC4; }
    .input-field.error { border-color: #FF6B6B; }
    .input-error { font-size: 10px; color: #FF6B6B; height: 14px; }
    .log-btn {
      width: 200px; height: 52px;
      font-size: 16px; font-weight: 700;
      letter-spacing: 2px;
      background-color: #4ECDC4;
      border: none;
      border-radius: 8px;
      color: #000;
      cursor: pointer;
      font-family: inherit;
    }
    .log-btn:disabled { background-color: #333; color: #666; }
    
    .history {
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 12px;
      background-color: #111;
      border-radius: 8px;
      max-height: 80px;
      overflow-y: auto;
    }
    .history-row { display: flex; gap: 12px; font-size: 12px; color: #666; }
    .history-num { width: 24px; color: #444; }
    .history-tank { width: 55px; }
    .history-val { width: 45px; text-align: right; color: #888; }
    .history-burn { color: #4ECDC4; }
    
    .offline-indicator {
      position: fixed;
      top: max(8px, env(safe-area-inset-top));
      right: 8px;
      padding: 4px 8px;
      background-color: #FF6B6B;
      color: #000;
      font-size: 9px;
      font-weight: 700;
      border-radius: 4px;
      display: none;
    }
    .offline-indicator.visible { display: block; }
  </style>
</head>
<body>
  <div class="offline-indicator" id="offline-indicator">OFFLINE</div>

  <div id="start-screen">
    <h1 class="title">N215C</h1>
    <p class="subtitle">FUEL TRACKER</p>
    
    <div class="resume-box" id="resume-box">
      <span class="resume-title">SAVED FLIGHT</span>
      <span class="resume-info" id="resume-info">--</span>
      
      <div class="resume-buttons" id="resume-buttons">
        <button class="resume-btn primary" onclick="resumeFlight()">RESUME</button>
        <button class="resume-btn secondary" onclick="showAddFuelPanel()">ADD FUEL</button>
        <button class="resume-btn tertiary" onclick="clearAll()">CLEAR</button>
      </div>
      
      <div class="add-fuel-panel" id="add-fuel-panel">
        <div class="add-fuel-grid">
          <div class="add-fuel-tank">
            <span class="add-fuel-label">L TIP</span>
            <span class="add-fuel-current" id="af-ltip-cur">0.0</span>
            <div class="add-fuel-row">
              <span class="add-fuel-plus">+</span>
              <input type="number" class="add-fuel-input" id="af-ltip" value="0" min="0" max="17">
            </div>
            <span class="add-fuel-new" id="af-ltip-new">0.0</span>
          </div>
          <div class="add-fuel-tank">
            <span class="add-fuel-label">L MAIN</span>
            <span class="add-fuel-current" id="af-lmain-cur">0.0</span>
            <div class="add-fuel-row">
              <span class="add-fuel-plus">+</span>
              <input type="number" class="add-fuel-input" id="af-lmain" value="0" min="0" max="25">
            </div>
            <span class="add-fuel-new" id="af-lmain-new">0.0</span>
          </div>
          <div class="add-fuel-tank">
            <span class="add-fuel-label">R MAIN</span>
            <span class="add-fuel-current" id="af-rmain-cur">0.0</span>
            <div class="add-fuel-row">
              <span class="add-fuel-plus">+</span>
              <input type="number" class="add-fuel-input" id="af-rmain" value="0" min="0" max="25">
            </div>
            <span class="add-fuel-new" id="af-rmain-new">0.0</span>
          </div>
          <div class="add-fuel-tank">
            <span class="add-fuel-label">R TIP</span>
            <span class="add-fuel-current" id="af-rtip-cur">0.0</span>
            <div class="add-fuel-row">
              <span class="add-fuel-plus">+</span>
              <input type="number" class="add-fuel-input" id="af-rtip" value="0" min="0" max="17">
            </div>
            <span class="add-fuel-new" id="af-rtip-new">0.0</span>
          </div>
        </div>
        <div class="add-fuel-summary">
          <span class="add-fuel-summary-label">NEW TOTAL</span>
          <span class="add-fuel-summary-value" id="af-total">0.0 GAL</span>
        </div>
        <button class="add-fuel-start" onclick="startWithAddedFuel()">START NEW CYCLE</button>
      </div>
    </div>
    
    <div class="new-flight-label" id="new-flight-label">NEW FLIGHT</div>
    
    <div class="preset-buttons">
      <button class="preset-btn" onclick="startFlight('topoff')">
        <span class="preset-name">TOP OFF</span>
        <span class="preset-detail">84 GAL</span>
        <span class="preset-tanks">17 / 25 / 25 / 17</span>
      </button>
      <button class="preset-btn" onclick="startFlight('tabs')">
        <span class="preset-name">TABS</span>
        <span class="preset-detail">70 GAL</span>
        <span class="preset-tanks">17 / 18 / 18 / 17</span>
      </button>
    </div>
    
    <button class="splash-btn" onclick="showSplashPanel()">CUSTOM SPLASH</button>
    
    <div class="splash-panel" id="splash-panel">
      <span class="splash-title">SET TANK LEVELS</span>
      <div class="add-fuel-grid">
        <div class="add-fuel-tank">
          <span class="add-fuel-label">L TIP</span>
          <input type="number" class="add-fuel-input" id="sp-ltip" value="17" min="0" max="17" style="width:44px;height:32px;font-size:15px;">
        </div>
        <div class="add-fuel-tank">
          <span class="add-fuel-label">L MAIN</span>
          <input type="number" class="add-fuel-input" id="sp-lmain" value="25" min="0" max="25" style="width:44px;height:32px;font-size:15px;">
        </div>
        <div class="add-fuel-tank">
          <span class="add-fuel-label">R MAIN</span>
          <input type="number" class="add-fuel-input" id="sp-rmain" value="25" min="0" max="25" style="width:44px;height:32px;font-size:15px;">
        </div>
        <div class="add-fuel-tank">
          <span class="add-fuel-label">R TIP</span>
          <input type="number" class="add-fuel-input" id="sp-rtip" value="17" min="0" max="17" style="width:44px;height:32px;font-size:15px;">
        </div>
      </div>
      <div class="add-fuel-summary">
        <span class="add-fuel-summary-label">TOTAL</span>
        <span class="add-fuel-summary-value" id="sp-total">84.0 GAL</span>
      </div>
      <button class="add-fuel-start" onclick="startSplash()">START FLIGHT</button>
    </div>
  </div>

  <div id="flight-screen">
    <div class="header">
      <div class="header-left">
        <button class="reset-btn" onclick="endFlight()">âœ•</button>
        <button class="undo-btn" id="undo-btn" onclick="undoLastSwap()" disabled>â†©</button>
      </div>
      <div class="header-center">
        <span class="preset-badge" id="preset-badge">TOP OFF</span>
        <span class="total-fuel" id="total-fuel">84.0 GAL</span>
      </div>
      <div class="swap-count" id="swap-count">#1</div>
    </div>

    <div class="phase-indicator" id="phase-indicator">MAINS PHASE</div>
    
    <div class="reserve-display">SAFETY RESERVE: 0.9 GAL</div>

    <div class="tank-display">
      <div class="wing">
        <div class="tank" id="tank-lTip"><div class="tank-label">L TIP</div><div class="tank-bar-outer"><div class="tank-bar-inner" id="bar-lTip"></div></div><div class="tank-value" id="val-lTip">17.0</div></div>
        <div class="tank" id="tank-lMain"><div class="tank-label">L MAIN</div><div class="tank-bar-outer"><div class="tank-bar-inner" id="bar-lMain"></div></div><div class="tank-value" id="val-lMain">25.0</div></div>
      </div>
      <div class="center-indicator">
        <div class="current-tank-label">BURNING</div>
        <div class="current-tank left" id="current-tank">L MAIN</div>
        <div class="next-tank-prompt">NEXT</div>
        <div class="next-tank-name" id="next-tank">R MAIN</div>
      </div>
      <div class="wing">
        <div class="tank" id="tank-rMain"><div class="tank-label">R MAIN</div><div class="tank-bar-outer"><div class="tank-bar-inner" id="bar-rMain"></div></div><div class="tank-value" id="val-rMain">25.0</div></div>
        <div class="tank" id="tank-rTip"><div class="tank-label">R TIP</div><div class="tank-bar-outer"><div class="tank-bar-inner" id="bar-rTip"></div></div><div class="tank-value" id="val-rTip">17.0</div></div>
      </div>
    </div>

    <div class="info-display"><div class="info-box"><span class="info-label">LAST READING</span><span class="info-value" id="last-reading">--</span></div></div>

    <div class="swap-targets" id="swap1-target"><div class="swap-target-box endurance"><span class="swap-target-label">SWAP AT</span><span class="swap-target-value">7.0</span></div></div>
    <div class="swap-targets hidden" id="swap2-targets"><div class="swap-target-box balanced"><span class="swap-target-label">BALANCED</span><span class="swap-target-value" id="balanced-value">--</span></div><div class="swap-target-box endurance"><span class="swap-target-label">ENDURANCE</span><span class="swap-target-value" id="endurance-value">--</span></div></div>
    <div class="swap-targets hidden" id="swap3-target"><div class="swap-target-box" id="locked-mode-box"><span class="swap-target-label" id="locked-mode-label">SWAP AT</span><span class="swap-target-value" id="locked-mode-value">--</span></div></div>

    <div class="input-section">
      <label class="input-label">TOTALIZER USED</label>
      <input type="number" step="0.1" class="input-field" id="totalizer-input" placeholder="0.0">
      <span class="input-error" id="input-error"></span>
      <button class="log-btn" id="log-btn" onclick="logSwap()">LOG SWAP</button>
    </div>

    <div class="history hidden" id="history"></div>
  </div>

  <script>
    const PRESETS = {
      topoff: { name: 'TOP OFF', lTip: 17, lMain: 25, rMain: 25, rTip: 17 },
      tabs: { name: 'TABS', lTip: 17, lMain: 18, rMain: 18, rTip: 17 }
    };
    
    const STORAGE_KEY = 'n215c_fuel_state';
    const SAFETY_RESERVE = 0.9;    // Absolute minimum - shown in warnings
    const EXHAUSTED_THRESHOLD = 2.0; // Tank considered "done" to avoid frivolous swaps
    const LOW_WARN = 3.0;
    const TIP_BURN = 8;
    
    // Burn targets by preset and mode
    const BURN_TARGETS = {
      topoff: {
        climbout: 7,
        balanced: { min: 7, max: 10 },
        endurance: { target: 19 }  // Leave ~6 gal reserve, drain on 3rd swap
      },
      tabs: {
        climbout: 7,
        balanced: { min: 10, max: 11 }  // Bigger burns, 2-3 swaps to exhaust
        // No endurance for tabs
      }
    };
    
    let state = {
      preset: null,
      customFuel: null,
      currentTank: 'lMain',
      swapLog: [],
      tankBurned: { lTip: 0, lMain: 0, rMain: 0, rTip: 0 },
      phase: 'mains',
      fuelExhausted: false,
      flightMode: null,
      swap2Targets: null
    };
    
    function saveState() { try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e){} }
    function loadState() { try { const v = localStorage.getItem(STORAGE_KEY); return v ? JSON.parse(v) : null; } catch(e){} return null; }
    function clearStorage() { try { localStorage.removeItem(STORAGE_KEY); } catch(e){} }
    
    function getSavedFuelLevels() {
      const saved = loadState();
      if (!saved || !saved.preset) return null;
      const levels = {};
      ['lTip', 'lMain', 'rMain', 'rTip'].forEach(t => {
        const start = saved.preset === 'custom' ? (saved.customFuel?.[t] || 0) : (PRESETS[saved.preset]?.[t] || 0);
        levels[t] = Math.max(0, start - (saved.tankBurned?.[t] || 0));
      });
      return levels;
    }
    
    function initApp() {
      checkOffline();
      window.addEventListener('online', checkOffline);
      window.addEventListener('offline', checkOffline);
      if (loadState()?.preset) showResumeBox();
      else hideResumeBox();
      setupListeners();
    }
    
    function checkOffline() {
      const el = document.getElementById('offline-indicator');
      if (el) el.classList.toggle('visible', !navigator.onLine);
    }
    
    function showResumeBox() {
      const box = document.getElementById('resume-box');
      const info = document.getElementById('resume-info');
      const panel = document.getElementById('add-fuel-panel');
      const btns = document.getElementById('resume-buttons');
      const label = document.getElementById('new-flight-label');
      
      if (!box) return;
      if (panel) panel.classList.remove('visible');
      if (btns) btns.style.display = 'flex';
      
      const saved = loadState();
      if (saved && saved.preset) {
        const name = saved.preset === 'custom' ? 'CUSTOM' : (PRESETS[saved.preset]?.name || 'FLIGHT');
        const levels = getSavedFuelLevels();
        const total = levels ? (levels.lTip + levels.lMain + levels.rMain + levels.rTip) : 0;
        const swapNum = (saved.swapLog?.length || 0) + 1;
        info.textContent = `${name} â€¢ ${total.toFixed(1)} GAL â€¢ Swap #${swapNum}`;
      }
      
      box.classList.add('visible');
      if (label) label.classList.remove('hidden');
      populateAddFuelPanel();
    }
    
    function hideResumeBox() {
      const box = document.getElementById('resume-box');
      const label = document.getElementById('new-flight-label');
      if (box) box.classList.remove('visible');
      if (label) label.classList.add('hidden');
    }
    
    function showAddFuelPanel() {
      const panel = document.getElementById('add-fuel-panel');
      const btns = document.getElementById('resume-buttons');
      if (panel) panel.classList.add('visible');
      if (btns) btns.style.display = 'none';
      populateAddFuelPanel();
    }
    
    function populateAddFuelPanel() {
      const levels = getSavedFuelLevels() || { lTip: 0, lMain: 0, rMain: 0, rTip: 0 };
      setText('af-ltip-cur', levels.lTip.toFixed(1));
      setText('af-lmain-cur', levels.lMain.toFixed(1));
      setText('af-rmain-cur', levels.rMain.toFixed(1));
      setText('af-rtip-cur', levels.rTip.toFixed(1));
      setVal('af-ltip', 0); setVal('af-lmain', 0); setVal('af-rmain', 0); setVal('af-rtip', 0);
      updateAddFuelTotals();
    }
    
    function updateAddFuelTotals() {
      const levels = getSavedFuelLevels() || { lTip: 0, lMain: 0, rMain: 0, rTip: 0 };
      const newLtip = Math.min(17, levels.lTip + getNum('af-ltip'));
      const newLmain = Math.min(25, levels.lMain + getNum('af-lmain'));
      const newRmain = Math.min(25, levels.rMain + getNum('af-rmain'));
      const newRtip = Math.min(17, levels.rTip + getNum('af-rtip'));
      setText('af-ltip-new', newLtip.toFixed(1));
      setText('af-lmain-new', newLmain.toFixed(1));
      setText('af-rmain-new', newRmain.toFixed(1));
      setText('af-rtip-new', newRtip.toFixed(1));
      setText('af-total', (newLtip + newLmain + newRmain + newRtip).toFixed(1) + ' GAL');
    }
    
    function showSplashPanel() {
      const panel = document.getElementById('splash-panel');
      panel?.classList.toggle('visible');
      updateSplashTotal();
    }
    
    function updateSplashTotal() {
      const total = getNum('sp-ltip') + getNum('sp-lmain') + getNum('sp-rmain') + getNum('sp-rtip');
      setText('sp-total', total.toFixed(1) + ' GAL');
    }
    
    function startFlight(presetKey) {
      state = { 
        preset: presetKey, 
        customFuel: null, 
        currentTank: 'lMain', 
        swapLog: [], 
        tankBurned: { lTip: 0, lMain: 0, rMain: 0, rTip: 0 }, 
        phase: 'mains', 
        fuelExhausted: false, 
        flightMode: presetKey === 'tabs' ? 'balanced' : null,  // Tabs always balanced
        swap2Targets: null 
      };
      saveState(); 
      showFlightScreen();
    }
    
    function startSplash() {
      const customFuel = {
        lTip: Math.min(17, getNum('sp-ltip')),
        lMain: Math.min(25, getNum('sp-lmain')),
        rMain: Math.min(25, getNum('sp-rmain')),
        rTip: Math.min(17, getNum('sp-rtip'))
      };
      state = { 
        preset: 'custom', 
        customFuel, 
        currentTank: 'lMain', 
        swapLog: [], 
        tankBurned: { lTip: 0, lMain: 0, rMain: 0, rTip: 0 }, 
        phase: 'mains', 
        fuelExhausted: false, 
        flightMode: 'balanced', 
        swap2Targets: null 
      };
      saveState(); 
      showFlightScreen();
    }
    
    function startWithAddedFuel() {
      const levels = getSavedFuelLevels() || { lTip: 0, lMain: 0, rMain: 0, rTip: 0 };
      const customFuel = {
        lTip: Math.min(17, levels.lTip + getNum('af-ltip')),
        lMain: Math.min(25, levels.lMain + getNum('af-lmain')),
        rMain: Math.min(25, levels.rMain + getNum('af-rmain')),
        rTip: Math.min(17, levels.rTip + getNum('af-rtip'))
      };
      state = { 
        preset: 'custom', 
        customFuel, 
        currentTank: 'lMain', 
        swapLog: [], 
        tankBurned: { lTip: 0, lMain: 0, rMain: 0, rTip: 0 }, 
        phase: 'mains', 
        fuelExhausted: false, 
        flightMode: 'balanced', 
        swap2Targets: null 
      };
      saveState(); 
      showFlightScreen();
    }
    
    function resumeFlight() {
      const saved = loadState();
      if (saved?.preset) { state = saved; showFlightScreen(); }
    }
    
    function clearAll() { clearStorage(); hideResumeBox(); }
    function endFlight() { saveState(); showStartScreen(); }
    
    function undoLastSwap() {
      if (state.swapLog.length === 0) return;
      
      const lastSwap = state.swapLog.pop();
      const tankKey = { 'L MAIN': 'lMain', 'R MAIN': 'rMain', 'L TIP': 'lTip', 'R TIP': 'rTip' }[lastSwap.tank];
      
      // Restore burned fuel
      if (tankKey) state.tankBurned[tankKey] -= lastSwap.burned;
      
      // Restore current tank to what it was
      state.currentTank = tankKey;
      
      // Check if we need to go back to mains phase
      if (state.phase === 'tips' && (tankKey === 'lMain' || tankKey === 'rMain')) {
        state.phase = 'mains';
      }
      
      // Reset mode if we're back to swap 1
      if (state.swapLog.length <= 1) {
        if (state.preset !== 'tabs' && state.preset !== 'custom') {
          state.flightMode = null;
        }
        state.swap2Targets = null;
      }
      
      state.fuelExhausted = false;
      saveState();
      updateDisplay();
    }
    
    function showFlightScreen() {
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('flight-screen').style.display = 'block';
      document.getElementById('splash-panel')?.classList.remove('visible');
      clearError();
      updateDisplay();
    }
    
    function showStartScreen() {
      document.getElementById('start-screen').style.display = 'flex';
      document.getElementById('flight-screen').style.display = 'none';
      setVal('totalizer-input', '');
      const hist = document.getElementById('history');
      if (hist) { hist.innerHTML = ''; hist.classList.add('hidden'); }
      if (loadState()?.preset) showResumeBox(); else hideResumeBox();
    }
    
    function getStartFuel(tank) {
      if (state.preset === 'custom') return state.customFuel?.[tank] || 0;
      return PRESETS[state.preset]?.[tank] || 0;
    }
    
    function getRemaining(tank) { return Math.max(0, getStartFuel(tank) - state.tankBurned[tank]); }
    function getTotalRemaining() { return getRemaining('lTip') + getRemaining('lMain') + getRemaining('rMain') + getRemaining('rTip'); }
    function getLastReading() { return state.swapLog.length ? state.swapLog[state.swapLog.length - 1].totalizer : null; }
    
    // Tank is "exhausted" if below threshold - avoids frivolous short swaps
    function isExhausted(tank) { return getRemaining(tank) < EXHAUSTED_THRESHOLD; }
    function mainsExhausted() { return isExhausted('lMain') && isExhausted('rMain'); }
    
    function countUsableTanks() {
      let count = 0;
      ['lTip', 'lMain', 'rMain', 'rTip'].forEach(t => {
        if (getRemaining(t) >= EXHAUSTED_THRESHOLD) count++;
      });
      return count;
    }
    
    function isLastTank() {
      if (getRemaining(state.currentTank) < EXHAUSTED_THRESHOLD) return false;
      return countUsableTanks() === 1;
    }
    
    // Is this the last burn for the CURRENT tank (even if other tanks have fuel)?
    function isLastBurnForTank() {
      const remaining = getRemaining(state.currentTank);
      if (remaining < EXHAUSTED_THRESHOLD) return false;
      
      const available = remaining - SAFETY_RESERVE;
      const normalBurn = getNormalBurn();
      
      // If we can't do another normal burn after this, it's the last burn
      return available <= normalBurn + 1;
    }
    
    function getNextTank() {
      if (state.fuelExhausted) return null;
      const lm = getRemaining('lMain'), rm = getRemaining('rMain');
      const lt = getRemaining('lTip'), rt = getRemaining('rTip');
      
      if (state.phase === 'tips') {
        if (state.currentTank === 'lTip') return rt >= EXHAUSTED_THRESHOLD ? 'rTip' : (lt >= EXHAUSTED_THRESHOLD ? 'lTip' : null);
        if (state.currentTank === 'rTip') return lt >= EXHAUSTED_THRESHOLD ? 'lTip' : (rt >= EXHAUSTED_THRESHOLD ? 'rTip' : null);
        return lt >= rt ? (lt >= EXHAUSTED_THRESHOLD ? 'lTip' : (rt >= EXHAUSTED_THRESHOLD ? 'rTip' : null)) 
                        : (rt >= EXHAUSTED_THRESHOLD ? 'rTip' : (lt >= EXHAUSTED_THRESHOLD ? 'lTip' : null));
      }
      
      if (!mainsExhausted()) {
        if (state.currentTank === 'lMain') return rm >= EXHAUSTED_THRESHOLD ? 'rMain' : (lm >= EXHAUSTED_THRESHOLD ? 'lMain' : null);
        if (state.currentTank === 'rMain') return lm >= EXHAUSTED_THRESHOLD ? 'lMain' : (rm >= EXHAUSTED_THRESHOLD ? 'rMain' : null);
        return lm >= rm ? 'lMain' : 'rMain';
      }
      
      // Mains exhausted, go to tips
      return lt >= rt ? (lt >= EXHAUSTED_THRESHOLD ? 'lTip' : (rt >= EXHAUSTED_THRESHOLD ? 'rTip' : null))
                      : (rt >= EXHAUSTED_THRESHOLD ? 'rTip' : (lt >= EXHAUSTED_THRESHOLD ? 'lTip' : null));
    }
    
    function getNormalBurn() {
      if (state.phase === 'tips') return TIP_BURN;
      
      const preset = state.preset;
      const mode = state.flightMode || 'balanced';
      const cur = getRemaining(state.currentTank);
      
      if (preset === 'tabs' || preset === 'custom') {
        // Tabs/Custom: bigger balanced burns
        const targets = BURN_TARGETS.tabs?.balanced || { min: 10, max: 11 };
        return Math.min(targets.max, Math.max(targets.min, cur - SAFETY_RESERVE));
      }
      
      if (preset === 'topoff') {
        if (mode === 'endurance') {
          return Math.min(BURN_TARGETS.topoff.endurance.target, cur - SAFETY_RESERVE);
        }
        const targets = BURN_TARGETS.topoff.balanced;
        return Math.min(targets.max, Math.max(targets.min, cur - SAFETY_RESERVE));
      }
      
      return Math.min(10, cur - SAFETY_RESERVE);
    }
    
    function getMaxTarget() {
      const lastReading = getLastReading();
      if (lastReading === null) return null;
      const remaining = getRemaining(state.currentTank);
      return lastReading + Math.max(0, remaining - SAFETY_RESERVE);
    }
    
    function calcTargets() {
      const last = getLastReading(), cur = getRemaining(state.currentTank);
      if (last === null || state.phase === 'tips') return { balanced: null, endurance: null };
      
      // Balanced target
      const balTargets = BURN_TARGETS[state.preset]?.balanced || { min: 7, max: 10 };
      let balBurn = Math.min(balTargets.max, cur - SAFETY_RESERVE);
      balBurn = Math.max(balTargets.min, balBurn);
      if (balBurn > cur - SAFETY_RESERVE) balBurn = cur - SAFETY_RESERVE;
      
      // Endurance target (only for topoff)
      let endBurn = 0;
      if (state.preset === 'topoff') {
        endBurn = Math.min(BURN_TARGETS.topoff.endurance.target, cur - SAFETY_RESERVE);
      }
      
      return {
        balanced: { target: last + balBurn, burn: balBurn },
        endurance: state.preset === 'topoff' ? { target: last + endBurn, burn: endBurn } : null
      };
    }
    
    function tankLabel(t) { return { lMain: 'L MAIN', rMain: 'R MAIN', lTip: 'L TIP', rTip: 'R TIP' }[t] || t; }
    function tankSide(t) { return t.startsWith('l') ? 'left' : 'right'; }
    
    function clearError() {
      const inp = document.getElementById('totalizer-input');
      const err = document.getElementById('input-error');
      if (inp) inp.classList.remove('error');
      if (err) err.textContent = '';
    }
    
    function showError(msg) {
      const inp = document.getElementById('totalizer-input');
      const err = document.getElementById('input-error');
      if (inp) inp.classList.add('error');
      if (err) err.textContent = msg;
    }
    
    function validateInput() {
      const inp = document.getElementById('totalizer-input');
      const reading = parseFloat(inp?.value);
      const last = getLastReading() || 0;
      
      clearError();
      
      if (isNaN(reading) || inp?.value === '') {
        return false;
      }
      
      if (reading < last) {
        showError(`Must be â‰¥ ${last.toFixed(1)}`);
        return false;
      }
      
      return true;
    }
    
    function logSwap() {
      if (state.fuelExhausted) return;
      if (!validateInput()) return;
      
      const input = document.getElementById('totalizer-input');
      const reading = parseFloat(input?.value);
      
      const burned = state.swapLog.length ? reading - state.swapLog[state.swapLog.length - 1].totalizer : reading;
      
      // Determine flight mode on swap 2 for topoff
      if (state.swapLog.length === 1 && state.swap2Targets && state.preset === 'topoff') {
        const avg = (state.swap2Targets.balanced + state.swap2Targets.endurance) / 2;
        state.flightMode = reading > avg ? 'endurance' : 'balanced';
      }
      
      state.tankBurned[state.currentTank] += burned;
      state.swapLog.push({ swapNumber: state.swapLog.length + 1, tank: tankLabel(state.currentTank), totalizer: reading, burned });
      
      // Check phase transition - use exhausted threshold
      if (state.phase === 'mains' && mainsExhausted()) { 
        state.phase = 'tips'; 
      }
      
      const next = getNextTank();
      if (next) state.currentTank = next;
      else state.fuelExhausted = true;
      
      input.value = '';
      clearError();
      saveState();
      updateDisplay();
    }
    
    function updateDisplay() {
      if (!state.preset) return;
      
      const isCustom = state.preset === 'custom';
      const isTabs = state.preset === 'tabs';
      const name = isCustom ? 'CUSTOM' : PRESETS[state.preset].name;
      const mode = state.flightMode;
      const swapCount = state.swapLog.length;
      const lastBurnTank = isLastBurnForTank();
      const lastTank = isLastTank();
      const maxTarget = getMaxTarget();
      
      setText('preset-badge', name);
      setText('total-fuel', getTotalRemaining().toFixed(1) + ' GAL');
      setText('swap-count', '#' + (swapCount + 1));
      
      // Undo button
      const undoBtn = document.getElementById('undo-btn');
      if (undoBtn) undoBtn.disabled = swapCount === 0;
      
      const phaseEl = document.getElementById('phase-indicator');
      if (phaseEl) {
        if (state.fuelExhausted) {
          phaseEl.textContent = 'FUEL EXHAUSTED';
          phaseEl.className = 'phase-indicator exhausted';
        } else if (state.phase === 'tips') {
          phaseEl.textContent = 'TIPS PHASE';
          phaseEl.className = 'phase-indicator tips-phase';
        } else {
          phaseEl.textContent = mode ? 'MAINS â€¢ ' + mode.toUpperCase() : 'MAINS PHASE';
          phaseEl.className = 'phase-indicator' + (mode ? ' ' + mode + '-mode' : '');
        }
      }
      
      const curEl = document.getElementById('current-tank');
      if (curEl) {
        curEl.textContent = state.fuelExhausted ? '--' : tankLabel(state.currentTank);
        curEl.className = 'current-tank ' + (state.fuelExhausted ? '' : tankSide(state.currentTank));
      }
      setText('next-tank', getNextTank() ? tankLabel(getNextTank()) : '--');
      setText('last-reading', getLastReading() !== null ? getLastReading().toFixed(1) : '--');
      
      const s1 = document.getElementById('swap1-target');
      const s2 = document.getElementById('swap2-targets');
      const s3 = document.getElementById('swap3-target');
      
      if (state.fuelExhausted) {
        s1?.classList.add('hidden'); s2?.classList.add('hidden'); s3?.classList.remove('hidden');
        setTargetBox('locked', 'COMPLETE', '--', 'balanced');
      } else if (swapCount === 0) {
        // First swap - climbout
        s1?.classList.remove('hidden'); s2?.classList.add('hidden'); s3?.classList.add('hidden');
      } else if (swapCount === 1 && state.phase === 'mains' && state.preset === 'topoff' && !mode) {
        // Swap 2 for topoff - show both options
        s1?.classList.add('hidden'); s2?.classList.remove('hidden'); s3?.classList.add('hidden');
        const t = calcTargets();
        if (t.balanced && t.endurance) {
          state.swap2Targets = { balanced: t.balanced.target, endurance: t.endurance.target };
          saveState();
          setText('balanced-value', t.balanced.target.toFixed(1));
          setText('endurance-value', t.endurance.target.toFixed(1));
        }
      } else if (state.phase === 'tips') {
        // Tips phase
        s1?.classList.add('hidden'); s2?.classList.add('hidden'); s3?.classList.remove('hidden');
        const last = getLastReading();
        
        if (lastTank && maxTarget && last !== null) {
          setZeroFuelTarget(maxTarget);
        } else if (lastBurnTank && maxTarget && last !== null) {
          setWarningTarget(maxTarget);
        } else if (last !== null) {
          const available = getRemaining(state.currentTank) - SAFETY_RESERVE;
          const burn = Math.min(TIP_BURN, available);
          setTargetBox('locked', 'SWAP AT', (last + burn).toFixed(1), 'balanced');
        } else {
          setTargetBox('locked', 'SWAP AT', '--', 'balanced');
        }
      } else if (state.phase === 'mains') {
        // Mains with mode locked
        s1?.classList.add('hidden'); s2?.classList.add('hidden'); s3?.classList.remove('hidden');
        
        if (lastTank && maxTarget) {
          setZeroFuelTarget(maxTarget);
        } else if (lastBurnTank && maxTarget) {
          setWarningTarget(maxTarget);
        } else {
          const t = calcTargets();
          const effectiveMode = mode || 'balanced';
          const sel = effectiveMode === 'endurance' ? t.endurance : t.balanced;
          if (sel) {
            setTargetBox('locked', effectiveMode === 'endurance' ? 'ENDURANCE' : (isTabs ? 'SWAP AT' : 'BALANCED'), sel.target.toFixed(1), effectiveMode);
          } else {
            setTargetBox('locked', 'SWAP AT', '--', 'balanced');
          }
        }
      } else {
        s1?.classList.add('hidden'); s2?.classList.add('hidden'); s3?.classList.remove('hidden');
        setTargetBox('locked', 'SWAP AT', '--', 'balanced');
      }
      
      // Tank display
      const maxes = { lTip: 17, lMain: 25, rMain: 25, rTip: 17 };
      const tipsLocked = state.phase === 'mains';
      
      ['lTip', 'lMain', 'rMain', 'rTip'].forEach(t => {
        const rem = getRemaining(t);
        const start = getStartFuel(t);
        const max = Math.max(start, maxes[t]);
        const pct = max > 0 ? (rem / max) * 100 : 0;
        const low = rem <= LOW_WARN && rem > 0;
        const empty = rem < EXHAUSTED_THRESHOLD;
        const active = state.currentTank === t && !state.fuelExhausted;
        const locked = t.includes('Tip') && tipsLocked;
        
        const tankEl = document.getElementById('tank-' + t);
        const barEl = document.getElementById('bar-' + t);
        const valEl = document.getElementById('val-' + t);
        
        if (tankEl) {
          tankEl.className = 'tank';
          if (active) tankEl.classList.add('active');
          else if (empty) tankEl.classList.add('empty');
          else if (locked) tankEl.classList.add('locked');
        }
        if (barEl) { 
          barEl.style.height = pct + '%'; 
          barEl.className = 'tank-bar-inner' + (low || empty ? ' low' : '') + (active && !low ? ' active' : ''); 
        }
        if (valEl) { 
          valEl.textContent = rem.toFixed(1); 
          valEl.className = 'tank-value' + (low || empty ? ' low' : ''); 
        }
      });
      
      // History
      const hist = document.getElementById('history');
      if (hist) {
        if (state.swapLog.length) {
          hist.classList.remove('hidden');
          hist.innerHTML = state.swapLog.slice(-4).reverse().map(l => 
            `<div class="history-row"><span class="history-num">#${l.swapNumber}</span><span class="history-tank">${l.tank}</span><span class="history-val">${l.totalizer.toFixed(1)}</span><span class="history-burn">+${l.burned.toFixed(1)}</span></div>`
          ).join('');
        } else hist.classList.add('hidden');
      }
      
      // Log button
      const btn = document.getElementById('log-btn');
      const inp = document.getElementById('totalizer-input');
      if (btn && inp) btn.disabled = state.fuelExhausted || !inp.value;
    }
    
    function setTargetBox(prefix, label, value, modeClass) {
      const box = document.getElementById(prefix + '-mode-box');
      const lbl = document.getElementById(prefix + '-mode-label');
      const val = document.getElementById(prefix + '-mode-value');
      if (box) box.className = 'swap-target-box locked-' + modeClass;
      if (lbl) { lbl.textContent = label; lbl.className = 'swap-target-label'; }
      if (val) val.textContent = value;
    }
    
    function setWarningTarget(maxTarget) {
      const box = document.getElementById('locked-mode-box');
      const lbl = document.getElementById('locked-mode-label');
      const val = document.getElementById('locked-mode-value');
      if (box) box.className = 'swap-target-box warning';
      if (lbl) { lbl.textContent = 'âš  DO NOT EXCEED'; lbl.className = 'swap-target-label warning'; }
      if (val) val.textContent = maxTarget.toFixed(1);
    }
    
    function setZeroFuelTarget(maxTarget) {
      const box = document.getElementById('locked-mode-box');
      const lbl = document.getElementById('locked-mode-label');
      const val = document.getElementById('locked-mode-value');
      if (box) box.className = 'swap-target-box zero-fuel';
      if (lbl) { lbl.textContent = 'ðŸ›‘ ZERO FUEL'; lbl.className = 'swap-target-label zero-fuel'; }
      if (val) val.textContent = maxTarget.toFixed(1);
    }
    
    function setText(id, txt) { const el = document.getElementById(id); if (el) el.textContent = txt; }
    function setVal(id, val) { const el = document.getElementById(id); if (el) el.value = val; }
    function getNum(id) { return parseFloat(document.getElementById(id)?.value) || 0; }
    
    function setupListeners() {
      document.getElementById('totalizer-input')?.addEventListener('input', function() {
        validateInput();
        const btn = document.getElementById('log-btn');
        if (btn) btn.disabled = state.fuelExhausted || !this.value;
      });
      
      ['af-ltip', 'af-lmain', 'af-rmain', 'af-rtip'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', updateAddFuelTotals);
      });
      
      ['sp-ltip', 'sp-lmain', 'sp-rmain', 'sp-rtip'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', updateSplashTotal);
      });
    }
    
    if ('serviceWorker' in navigator) {
      const sw = `const C='n215c-v8';self.addEventListener('install',()=>self.skipWaiting());self.addEventListener('activate',e=>e.waitUntil(clients.claim()));self.addEventListener('fetch',e=>e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(res=>caches.open(C).then(c=>{c.put(e.request,res.clone());return res;}))).catch(()=>new Response('Offline'))));`;
      navigator.serviceWorker.register(URL.createObjectURL(new Blob([sw], {type:'application/javascript'}))).catch(()=>{});
    }
    
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
